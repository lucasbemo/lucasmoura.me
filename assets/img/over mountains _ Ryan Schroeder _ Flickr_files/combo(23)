YUI.add("hermes-template-sub-photo-keyboard-shortcuts",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'	<div class="sub-photo-keyboard-shortcuts" tabindex="1" aria-label="'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.KEYBOARD_SHORTCUTS"},data:i}))+'">\n'+((s=n["if"].call(o,t!=null?t.signedIn:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n		<!--Search Shortcut -->\n		<div class="key-container" tabindex="1">\n			<span class="search-key key">S</span>\n			<span class="search-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.SEARCH"},data:i}))+'</span>\n		</div>\n\n		<!--Photo Navigation Shortcut -->\n		<div class="key-container" tabindex="1">\n			<span class="photo-navigation-key-left key"><i class="photo-navigation-key-icon-left" aria-label="'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.LEFT_ARROW"},data:i}))+'"></i></span>\n			<span class="photo-navigation-key-right key"><i class="photo-navigation-key-icon-right" aria-label="'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.RIGHT_ARROW"},data:i}))+'"></i></span>\n			<span class="photo-navigation-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_NAVIGATION"},data:i}))+'</span>\n		</div>\n\n		<!--Thumbnail Navigation Shortcut -->\n		<div class="key-container" tabindex="1">\n			<span class="thumbnail-navigation-key-left key"> &lt; </span>\n			<span class="thumbnail-navigation-key-right key"> &gt; </span>\n			<span class="thumbnail-navigation-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.THUMBNAIL_NAVIGATION"},data:i}))+"</span>\n		</div>\n\n		<!--Zoom Shortcut -->\n"+((s=n["if"].call(o,t!=null?t.enableZoom:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'\n		<!--Back to Context Shortcut -->\n		<div class="key-container'+((s=n.unless.call(o,t!=null?t.canGoBackTo:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.canGoBackTo:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n			<span class="back-to-context-key key">B</span>\n			<span class="back-to-context-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.BACK_TO_CONTEXT"},data:i}))+"</span>\n		</div>\n\n"+((s=n["if"].call(o,t!=null?t.signedIn:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+"	</div>\n"},2:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'			<!--Favorite Shortcut -->\n			<div class="key-container'+((s=n["if"].call(o,t!=null?t.isOwner:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n.unless.call(o,t!=null?t.isOwner:t,{name:"unless",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n				<span class="favorite-key key">F</span>\n				<span class="favorite-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.FAVORITE"},data:i}))+'</span>\n			</div>\n\n			<!--Comment Shortcut -->\n			<div class="key-container'+((s=n.unless.call(o,t!=null?t.canAddComment:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.canAddComment:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n				<span class="comment-key key">C</span>\n				<span class="comment-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.COMMENT"},data:i}))+"</span>\n			</div>\n"},3:function(e,t,n,r,i){return" disabled"},5:function(e,t,n,r,i){return'tabindex="1"'},7:function(e,t,n,r,i){return'			<div class="key-container" tabindex="1">\n				<span class="search-key key">Z</span>\n				<span class="search-key-label key-label">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ZOOM"},data:i}))+"</span>\n			</div>\n"},9:function(e,t,n,r,i){return'		<!--Lightbox Shortcut -->\n			<div class="key-container" tabindex="1">\n				<span class="search-key key">L</span>\n				<span class="search-key-label key-label">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.VIEW_IN_LIGHTBOX"},data:i}))+"</span>\n			</div>\n"},11:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"\n"+((s=n["if"].call(o,t!=null?t.isOwner:t,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:"")+'\n			<!--Tagging Shortcuts -->\n			<div class="key-container'+((s=n.unless.call(o,t!=null?t.canAddMeta:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.canAddMeta:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n				<span class="add-tag-key key">T</span>\n				<span class="add-tag-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TAG"},data:i}))+'</span>\n			</div>\n\n			<div class="key-container'+((s=n.unless.call(o,t!=null?t.canAddMeta:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.canAddMeta:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n				<span class="add-person-key key">P</span>\n				<span class="add-person-key-label key-label">'+
a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_PERSON"},data:i}))+"</span>\n			</div>\n"},12:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'\n				<!--Add to Group Shortcut -->\n				<div class="key-container'+((s=n.unless.call(o,t!=null?t.canAddToGroup:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.canAddToGroup:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n					<span class="add-to-group-key key">G</span>\n					<span class="add-to-group-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GROUP"},data:i}))+'</span>\n				</div>\n\n				<!--Add to album Shortcut -->\n				<div class="key-container'+((s=n.unless.call(o,t!=null?t.canAddToAlbum:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.canAddToAlbum:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n					<span class="add-to-album-key key">A</span>\n					<span class="add-to-album-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_ALBUM"},data:i}))+"</span>\n				</div>\n\n"},14:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return'\n				<!--Invite to group Shortcut -->\n				<div class="key-container'+((s=n.unless.call(o,t!=null?t.canInviteToGroup:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.canInviteToGroup:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n					<span class="add-to-group-key key">G</span>\n					<span class="add-to-group-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.INVITE_TO_GROUP"},data:i}))+'</span>\n				</div>\n\n				<!--Add to gallery Shortcut -->\n				<div class="key-container'+((s=n.unless.call(o,t!=null?t.canAddToGallery:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" '+((s=n["if"].call(o,t!=null?t.canAddToGallery:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'>\n					<span class="add-to-album-key key">A</span>\n					<span class="add-to-album-key-label key-label">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GALLERY"},data:i}))+"</span>\n				</div>\n\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.keyboardShortcutsEnabled:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-keyboard-shortcuts",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("sub-photo-keyboard-shortcuts-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.backToURL=e.backToURL,this.hideBackToLink=e.hideBackToLink,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=[];return n.push(t.appContext.getModel("photo-models",t.photoId).then(function(e){t.set("photo",e)})),n.push(t.appContext.getModel("photo-privacy-models",t.photoId).then(function(e){t.set("photoPrivacyModel",e)})),t.appContext.getViewer().signedIn&&n.push(t.appContext.getModel("person-groups-models",t.appContext.getViewer().nsid).then(function(e){t.set("personGroupsModel",e)})),e.Promise.all(n)},buildContainer:function(){return this.setContainerWithTemplate("sub-photo-keyboard-shortcuts",{signedIn:this.appContext.getViewer().signedIn,isOwner:this.get("photo").getValue("owner").getValue("isMe"),enableZoom:!0,canAddToAlbum:this.canAddToAlbum(),canAddToGallery:this.canAddToGallery(),canAddToGroup:this.canAddToGroup(),canInviteToGroup:this.canInviteToGroup(),canAddMeta:this.canAddMeta(),canAddComment:this.get("photo").getValue("canComment"),canGoBackTo:!this.hideBackToLink,keyboardShortcutsEnabled:this.appContext.getViewer().prefs.keyboardShortcutsEnabled}),this},canAddToGallery:function(){var e=this.get("photo").getValue("safetyLevel")===0,t=this.get("photoPrivacyModel").getValue("isPublic");return e&&t&&this.appContext.getViewer().nsid!==this._params.nsid&&this.appContext.getViewer().signedIn},canAddToAlbum:function(){return this.appContext.getViewer().nsid===this._params.nsid},canAddToGroup:function(){var e=this.appContext.getViewer().nsid,t=this.get("photo").getValue("owner").getValue("id"),n=this.get("personGroupsModel");return t===e&&n&&(this.get("personGroupsModel").getValue("memberCount")>0||this.get("personGroupsModel").getValue("adminCount")>0||this.get("personGroupsModel").getValue("moderatorCount")>0)},canInviteToGroup:function(){var e=this.appContext.getViewer().nsid,t=this.get("photo").getValue("owner").getValue("id"),n=this.get("personGroupsModel");return t!==e&&n&&n.getValue("adminCount")>0},canAddMeta:function(){var e=this.get("photo");return e.getValue("owner")||e.getValue("canAddMeta")},buildErrorContainer:function(){},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-keyboard-shortcuts","url-helper"],optional:[],langBundles:["common","photo-page-scrappy"]});
YUI.add("sub-photo-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.backToURL=e.backToURL,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"sub-photo-left-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"sub-photo-right-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"sub-photo-keyboard-shortcuts-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("sub-photo"),this},buildErrorContainer:function(){},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo","url-helper"],optional:["sub-photo-left-view","sub-photo-right-view","sub-photo-keyboard-shortcuts-view"]});
YUI.add("hermes-template-signup-footer",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"mini-footer"},3:function(e,t,n,r,i){return"large-footer"},5:function(e,t,n,r,i){return"has-logo"},7:function(e,t,n,r,i){return'		<div class="close-x"></div>\n'},9:function(e,t,n,r,i){var s;return(s=(n.isFlipped||t&&t.isFlipped||n.helperMissing).call(t!=null?t:{},"mini-signup-footer-avatar",{name:"isFlipped",hash:{},fn:e.program(10,i,0),inverse:e.program(12,i,0),data:i}))!=null?s:""},10:function(e,t,n,r,i){var s;return'			<div class="avatar person" style="background-image: url('+e.escapeExpression((s=(s=n.buddyIcon||(t!=null?t.buddyIcon:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"buddyIcon",hash:{},data:i}):s))+')"></div>\n'},12:function(e,t,n,r,i){return'			<div class="logo"></div>\n'},14:function(e,t,n,r,i){return'		<div class="logo"></div>\n'},16:function(e,t,n,r,i){return"mini"},18:function(e,t,n,r,i){return"large"},20:function(e,t,n,r,i){return"miniSignupFooterSignupClick"},22:function(e,t,n,r,i){return"signupFooterSignupClick"},24:function(e,t,n,r,i){return"miniSignupFooterSigninClick"},26:function(e,t,n,r,i){return"signupFooterSigninClick"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression;return'<div class="signup-footer '+((s=n["if"].call(u,t!=null?t.isMiniFooter:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+" "+((s=(n.isNotFlipped||t&&t.isNotFlipped||a).call(u,"mini-signup-footer-avatar",{name:"isNotFlipped",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n'+((s=(n.isFlipped||t&&t.isFlipped||a).call(u,"mini-signup-footer-cancellable",{name:"isFlipped",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(u,t!=null?t.isProfilePage:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:"")+'	<p class="truncate">'+f((o=(o=n.message||(t!=null?t.message:t))!=null?o:a,typeof o=="function"?o.call(u,{name:"message",hash:{},data:i}):o))+'</p>\n	<a href="/signup" class="'+((s=n["if"].call(u,t!=null?t.isMiniFooter:t,{name:"if",hash:{},fn:e.program(16,i,0),inverse:e.program(18,i,0),data:i}))!=null?s:"")+' butt" data-track="'+((s=n["if"].call(u,t!=null?t.isMiniFooter:t,{name:"if",hash:{},fn:e.program(20,i,0),inverse:e.program(22,i,0),data:i}))!=null?s:"")+'">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"sohp.SIGN_UP_WITH_YAHOO"},data:i}))+'</a>\n	<p class="signin">or <a href="/signin" data-track="'+((s=n["if"].call(u,t!=null?t.isMiniFooter:t,{name:"if",hash:{},fn:e.program(24,i,0),inverse:e.program(26,i,0),data:i}))!=null?s:"")+'">'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a><p>\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/signup-footer",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("signup-footer-view",function(e,t){"use strict";var n=200;e.namespace("Views").SignUpFooterView=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.set("pageNSID",e.nsid),this.set("groupID",e.groupId),this.set("pageType",e.pageType!==undefined?e.pageType:"profile"),this.set("messageIntlName",e.messageIntlName),this.set("query",e.searchTerm),e.isMobile||!this.appContext.flipper.isFlipped("enable-mini-sign-up-footer")||this.appContext.getViewer().signedIn||this.appContext.lang!=="en-US"?this.set("showPopup",!1):this.set("showPopup",!0),this.appContext.flipper.isFlipped("enable-large-sign-up-footer")?(this.set("modalType",""),this.set("beaconPrefix","signupFooter")):(this.set("modalType","mini"),this.set("beaconPrefix","miniSignupFooter"))},loadState:function(){var t=this;return this.get("showPopup")?this.get("pageType")==="profile"?this.appContext.getModel("person-models",this.get("pageNSID")).then(function(e){t.set("personModel",e)}):this.get("pageType")==="group"?this.appContext.getModel("group-info-models",this.get("groupID")).then(function(e){t.set("groupModel",e)}):e.Promise.resolve():e.Promise.resolve()},buildContainer:function(){var t={isProfilePage:this.get("pageType")==="profile"||this.get("pageType")==="group"};return this.get("showPopup")?(this.get("pageType")==="profile"?(t.buddyIcon=this.appContext.flipper.isFlipped("mini-signup-footer-avatar")?this.get("personModel").getValue("buddyicon").default:"",t.message=this.intlMessage({intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE",username:e.flutil.unescape(this.get("personModel").getValue("displayname"))})):this.get("pageType")==="explore"?t.message=this.intlMessage({intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE_EXPLORE"}):this.get("pageType")==="group"?(t.buddyIcon=this.appContext.flipper.isFlipped("mini-signup-footer-avatar")?this.get("groupModel").getValue("group").getValue("bestIconURL"):"",t.message=this.intlMessage({intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE",username:e.flutil.unescape(this.get("groupModel").getValue("group").getValue("title"))})):t.message=this.intlMessage({intlName:"growth.MINI_SIGNUP_FOOTER_MESSAGE_SEARCH",query:this.get("query")}),this.get("modalType")==="mini"&&(t.isMiniFooter=!0),this.setContainerWithTemplate("signup-footer",t),this):this},activate:function(){if(!this.get("showPopup"))return;this.initialScroll=e.config.win.pageYOffset,this.signupFooterNode=this.get("container").one(".signup-footer"),this.signupFooterHeight=parseInt(this.signupFooterNode.getStyle("height"),10),this.signupFooterOffset=parseInt(this.signupFooterNode.getStyle("bottom"),10),this.registerEventHandler(e.globalEvents.subscribe("window:scroll:nothrottle",this.handleScroll.bind(this))),this.appContext.flipper.isFlipped("mini-signup-footer-cancellable")&&this.get("container").one(".close-x")&&this.registerEventHandler(this.get("container").one(".close-x").on("click",this.handleCancelClick.bind(this))),this.footerContainer=e.one(".footer-full-view"),this.footer=this.footerContainer?e.one("footer.foot"):null},showMiniSignupFooter:function(){var t,n=e.StorageHelper.getItem("miniSignupFooterSeen"),r;return n?(n=e.moment(n,"x"),r=e.moment().subtract(1,"days"),r>n&&(t=!0)):t=!0,t},handleCancelClick:function(n){this.signupFooterNode&&(this.signupFooterNode.removeClass("show"),this.signupFooterNode.removeClass("footer-bottom")),e.rapidTracker.beacon(t,this.get("beaconPrefix")+"CancelClick"),this.set("showPopup",!1)},handleScroll:function(r){if(!this.get("showPopup"))return;var i=e.config.win.pageYOffset-this.initialScroll,s=i-n,o;Math.abs(i)>n||i<=0?Math.abs(this.signupFooterHeight-s)>=0&&i>0&&(this.signupFooterNode.hasClass("show")||(this.signupFooterNode.addClass("show"),this.set("anchoredToWindowCorner",!0),e.rapidTracker.beacon(t,this.get("beaconPrefix")+"Show"))):this.signupFooterNode.hasClass("show")&&!this.appContext.flipper.isFlipped("mini-signup-footer-cancellable")&&(this.signupFooterNode.removeClass("show"),e.rapidTracker.beacon(t,this.get("beaconPrefix")+"Hide")),o=e.config.win.pageYOffset+this.appContext.viewportData.getHeight()-this.signupFooterOffset,this.footerContainer.getComputedStyle("display")!=="none"&&o>=this.footer.getY()?this.signupFooterNode.hasClass("footer-bottom")||(this.signupFooterNode.addClass("footer-bottom"),this.set("anchoredToWindowCorner",!1)):this.get("anchoredToWindowCorner")||(this.signupFooterNode.removeClass("footer-bottom"),this.set("anchoredToWindowCorner",!0))}},{ATTRS:{isActiveViewAgnostic:{value:!0}}})},"@VERSION@",{requires:["flickr-view","hermes-template-signup-footer","storage-helper","moment","flutil"],optionalRequires:["global-events"],langBundles:["common","sohp","growth"]});
YUI.add("hermes-lang-sohp_pt-br",function(e,t){e.Intl.add("hermes/sohp","pt-BR",{MAIN_BUCKET_HEADLINE:["Flickr. O melhor lugar para todas as suas fotos."],MAIN_BUCKET_HEADLINE_NEW:["O melhor lugar para todas as suas fotos."],MAIN_BUCKET_BODY:["Fa\u00e7a upload, acesse, organize, edite e compartilhe suas fotos de qualquer aparelho, de qualquer lugar do mundo."],SIGN_UP_WITH_YAHOO:["Cadastre-se no Yahoo"],SPACE_BUCKET_HEADLINE:["Nunca mais apague uma foto"],SPACE_BUCKET_BODY:["Tenha 1.000 GB de armazenamento gratuito de fotos. N\u00f3s inclusive te ajudamos a fazer o backup autom\u00e1tico da sua cole\u00e7\u00e3o completa."],PLATFORMS_BUCKET_HEADLINE:["Suas fotos de qualquer lugar"],PLATFORMS_BUCKET_BODY:["Onde quer que voc\u00ea v\u00e1, suas fotos estar\u00e3o com voc\u00ea. Veja, edite e compartilhe com nossos apps premiados."],LEARN_MORE:["Saiba mais"],SEARCH_BUCKET_HEADLINE:["Um recurso incr\u00edvel de busca"],SEARCH_BUCKET_BODY:["Aprimoramos muito a busca de fotos. Agora ela \u00e9 a maneira mais f\u00e1cil e r\u00e1pida de localizar a foto exata que voc\u00ea deseja."],INSPIRATION_BUCKET_HEADLINE:["Inspira\u00e7\u00e3o de tirar o f\u00f4lego"],INSPIRATION_BUCKET_BODY:["Encontre lindas fotos compartilhadas por uma comunidade de fot\u00f3grafos amadores e profissionais."],TAKE_MY_BREATH_AWAY:["Surpreenda-me"],GET_STARTED_WITH_STORAGE:["Comece com seu armazenamento gratuito de 1.000 GB em fotos"],INSPIRE_ME:["Inspire-me"],SIGN_IN:["entrar"],PAGE_TITLE:["Flickr | O melhor lugar para todas as suas fotos | 1.000 GB gr\u00e1tis para armazenamento de fotos"],PAGE_DESCRIPTION:["O melhor lugar para todas as suas fotos. Fa\u00e7a upload, acesse, organize, edite e compartilhe suas fotos de qualquer aparelho, de qualquer lugar do mundo. 1.000 GB gr\u00e1tis para armazenamento de fotos."],SOHP_COMMUNITY_HEADLINE:["Seu lugar para fotografias inspiradoras."],SOHP_COMMUNITY_SUBTITLE:["Descubra as fotos mais interessantes do mundo."],SOHP_COMMUNITY_TITLE_INSPIRE:["Inspire-se"],SOHP_COMMUNITY_BODY_INSPIRE:["Veja as fotos de tend\u00eancias todos os dias de alguns dos maiores nomes no mundo, como NASA, Casa Branca, Cuba Gallery."],SOHP_COMMUNITY_TITLE_PASSION:["Explore sua paix\u00e3o"],SOHP_COMMUNITY_BODY_PASSION:["Conecte-se com uma comunidade din\u00e2mica para explorar qualquer interesse que voc\u00ea possa imaginar."],SOHP_COMMUNITY_TITLE_FIND:["Encontre a foto perfeita"],SOHP_COMMUNITY_BODY_FIND:["Pesquise mais de 12 bilh\u00f5es de fotos como nunca antes, por cor, est\u00e9tica e tipo de licen\u00e7a.  Suas apresenta\u00e7\u00f5es agradecem a voc\u00ea."],SOHP_COMMUNITY_FOOTER:["Participe da maior comunidade de fotografia do mundo"],SOHP_MANAGEMENT_HEADLINE:["O melhor lugar para todas as suas fotos"],SOHP_MANAGEMENT_SUBTITLE:["Gerenciamento de fotos privadas para todos os seus dispositivos."],SOHP_MANAGEMENT_TITLE_STORAGE:["Armazenamento expansivo"],SOHP_MANAGEMENT_BODY_STORAGE:["Nunca mais apague uma foto ou v\u00eddeo com 1.000 GB de armazenamento gratuito."],SOHP_MANAGEMENT_TITLE_BACKUP:["Backup automatizado"],SOHP_MANAGEMENT_BODY_BACKUP:["Fa\u00e7a backup automaticamente de toda a sua cole\u00e7\u00e3o do computador, iOS e dispositivo Android."],SOHP_MANAGEMENT_TITLE_ORGANIZATION:["Organiza\u00e7\u00e3o simples"],SOHP_MANAGEMENT_BODY_ORGANIZATION:["Organize milhares de fotos e v\u00eddeos usando a visualiza\u00e7\u00e3o no rolo da c\u00e2mera."],SOHP_MANAGEMENT_TITLE_SEARCH:["Busca inteligente"],SOHP_MANAGEMENT_BODY_SEARCH:["Encontre facilmente a foto exata desejada com nossa busca inteligente de fotos."],SOHP_MANAGEMENT_TITLE_ACCESS:["Acesso f\u00e1cil"],SOHP_MANAGEMENT_BODY_ACCESS:["Acesse suas fotos e v\u00eddeos de qualquer lugar com nossos aplicativos premiados."],SOHP_MANAGEMENT_TITLE_SHARING:["Compartilhamento perfeito"],SOHP_MANAGEMENT_BODY_SHARING:["Compartilhe suas mem\u00f3rias privadamente em qualquer rede social."],SOHP_MANAGEMENT_FOOTER:["Comece a usar os seus 1.000 GB gratuitos de armazenamento de fotos"],SOHP_TITLE_INSPIRATION:["Encontre sua inspira\u00e7\u00e3o."],SOHP_BODY_INSPIRATION:["Participe da comunidade do Flickr, onde voc\u00ea encontra 13 bilh\u00f5es de fotos, 120 milh\u00f5es de pessoas e 2 milh\u00f5es de grupos."],SOHP_BODY_INSPIRATION_MOD:["Participe da comunidade do Flickr, onde voc\u00ea encontra 13 bilh\u00f5es de fotos e 2 milh\u00f5es de grupos."]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-page-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n=this;this.backToURL=t.backToURL,this.hideBackToLink=t.hideBackToLink||!1,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.nsid=t.nsid,t.isOwner=this.isOwner,t.fullscreen?this.appContext.experiments.fullscreen.enableFullscreen():this.appContext.experiments.fullscreen.disableFullscreen(),this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext));if(this.context&&this.context.params&&this.context.params.isSharedEntity){var r=this.context.params;this.appContext.setGPCredentials({gp_code:r.gpCode,gp_owner:r.gpOwner,share_code:r.gpCode})}else this.appContext.setGPCredentials(null);return this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one&&e.one("head title").set("text",n.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),YUI.Env.isServer&&this.appContext&&this.appContext.flipper.isFlipped("enable-better-photo-page-seo")&&(this.appContext.forceServerRender=this.appContext._doForcedServerRender()),t.logViewTimings=!0,this},subviewConfig:{"photo-well-scrappy-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"sub-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return!this.appContext.getViewer().signedIn&&this.appContext.flipper.isFlipped("global-nav-enabled")&&e.push("has-global-nav"),e},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){var t,n=!1;return n?t="":t=this.subviews["global-nav-view"].get("container"),this.setContainerWithTemplate("photo-page-scrappy",{"global-nav-view":t,"photo-well-view":this.subviews["photo-well-scrappy-view"]?this.subviews["photo-well-scrappy-view"].get("container"):""}),e.fletrics.increment("test.photo.page.requests"),this},activate:function(){var e=this;return this.appContext.adManager.isEnabled()&&(this.appContext.adManager.updatePhotoAdsCounter(),this.appContext.adManager.fetchAdIfRequired({spaceid:this.get("spaceid")})),this},closeDialog:function(t){e.config.win.location.href=this.backToURL},onSubviewEvent:function(e,t){var n;if(t&&t.length>0&&!(t[0]==="make in view"&&t.length>1)&&t[0]!=="close in view")if(t[0]==="getDialogOffset")t[1]&&typeof t[1]=="function"&&(n=this.subviews["photo-well-scrappy-view"].get("container"),n&&t[1](parseInt(n.getStyle("right").replace("px",""),10)/2));else if(t[0]==="setRedirect")this.get("container").all("input[name=redirect_url]").setAttribute("value",window.location.pathname),typeof t[1]=="function"&&t[1]();else{if(t[0]==="rightClickPhoto")return!1;t[0]==="photo:reload"?this.reload(["photo-models","photostream-models","photo-exif-models"],this.photoId):(t[0]==="disable-sharing"||t[0]==="enable-sharing")&&this.fire("parentViewEvent",t[0])}},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)},buildErrorContainer:function(){this.error&&this.error.is404&&this.appContext.flapp.navigate("/error/notfound")}},{ATTRS:{spaceid:{value:792600543}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-scrappy","fletrics","ttfp-recorder-plugin","signin-helper","overflow-helper","url"],optional:["photo-well-scrappy-view","photo-head-meta-view","global-nav-view","sub-photo-view","signup-footer-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("photo-route",function(e,t){function s(e){s.superclass.constructor.call(this,e)}var n=require("lib/helpers/type-validator"),r=require("lib/flog")(t),i={activity_feed:{backToIntlKey:"BACK_TO_ACTIVITY_FEED",usesWith:!1},album:{backToIntlKey:"BACK_TO_ALBUM",usesWith:!0},commons:{backToIntlKey:"BACK_TO_COMMONS",usesWith:!1},contacts_list:{backToIntlKey:"BACK_TO_CONTACTS_LIST",usesWith:!1},explore:{backToIntlKey:"BACK_TO_EXPLORE",usesWith:!0},favorites:{backToIntlKey:"BACK_TO_FAVORITES",usesWith:!0},gallery:{backToIntlKey:"BACK_TO_GALLERY",usesWith:!0},groups:{backToIntlKey:"BACK_TO_GROUPS"},group:{backToIntlKey:"BACK_TO_GROUP",usesWith:!0,withParamName:"pool/with"},map:{backToIntlKey:"BACK_TO_MAP",usesWith:!1},photostream:{backToIntlKey:"BACK_TO_PHOTOSTREAM",usesWith:!0},profile:{backToIntlKey:"BACK_TO_PROFILE",usesWith:!1},search:{backToIntlKey:"BACK_TO_SEARCH",usesWith:!1},shares:{backToIntlKey:"BACK_TO_SHARED_PHOTOS",usesWith:!1},tags:{backToIntlKey:"BACK_TO_TAG",usesWith:!1},tag:{backToIntlKey:"BACK_TO_TAG",usesWith:!1}};e.Routes[this.name]=s,e.extend(s,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(t,r){var i=this,s=t.params.nsid_or_path_alias,o=t.params.photo_id,u=t.params.context,a=t.params.lightbox==="lightbox",f=t.params.vr==="vr",l=t.params.comment_id,c={id:o},h=t.query||{},p=!1,d;return l&&r.redirect(t.url.replace("/"+l,"")+"#"+l),n.nsid(s)?c.userId=s:c.pathAlias=s,d=i.parseContext(u,s,t),d&&d.params&&d.params.isSharedEntity?this.appContext.setGPCredentials({gp_code:d.params.gpCode,gp_owner:d.params.gpOwner,share_code:d.params.gpCode}):this.appContext.setGPCredentials(null),h&&h.cr!==undefined&&(p=!0),this.appContext.flipper.isFlipped("get-context-photos-in-photo-page-route")&&(d&&d.params&&d.modelName&&d.modelName!=="photostream-models"?c.context=u:c.context="photostream"),this.appContext.getModel("photo-models",c).then(function(n){var o,l,c,h,v,m,g,y,b,w,E=!0,S,x;return v=a?"photo-page-lightbox-scrappy-view":"photo-page-scrappy-view",m="scrolling",g="photo-page-ad-scrappy-view",y="scrolling",o=i.verifyPhotoIsViewable(n),h=i.detectRouteErrors(o),h.length?i.displayRouteErrors(t,h):(l=i.verifyPhotoIsOwnedByPerson(n,s),w=l,h=i.detectRouteErrors(l),h.length?i.displayRouteErrors(t,h):(S=6,x=12,i.appContext.forceServerRender&&(S=2,x=0),i.detectBackToDestination(t,{person:s,photoId:o,context:u}),b=i.getBackToData(),h.length?i.displayRouteErrors(t,h):(d.modelName==="photostream-models"&&(d.params.id=e.Models[d.modelName].buildCompoundId(l,d.params.orderBy,d.params.viewAs),w=d.params.id,delete d.params.pathAlias),i.appContext.adManager.isEnabled()&&i.appContext.adManager.adNext()&&!a&&!t.UA.isMobileBrowser?(i.appContext.adManager.resetPhotoAdsCounter(),i.appContext.adManager.showAd(),{view:g,params:{ad:!0,photoId:o,nsid:l,photostreamId:w,context:d,backToURL:b.path,hideBackToLink:p,entryTypeIntlKey:b.backToIntlKey,numberOfPositionsToPreFetch:S,numberOfPositionsToRefetchAt:x},title:"Flickr",layout:y}):(i.appContext.flipper.isFlipped("enable-new-mobile-photo-page")&&t.UA.isMobileBrowser&&(YUI.Env.isServer&&r.set("Vary","User-Agent"),v="mobile-photo-page-view",E=!1),t.UA.isFacebook&&(v="photo-page-meta-tags-only",m="opengraph",E=!1),{view:v,params:{photoId:o,nsid:l,photostreamId:w,context:d,backToURL:b.path,hideBackToLink:p,entryTypeIntlKey:b.backToIntlKey,fullscreen:a,numberOfPositionsToPreFetch:S,numberOfPositionsToRefetchAt:x,isVR:f,linkedToGalleries:!!t.params.galleries},title:e.Seo.getSEOTitleForPhoto(n),layout:m,darkLoader:E}))))},function(n){var r="Couldn't load photo page";t.UA.isMobileBrowser&&i.appContext.flipper.isFlipped("enable-new-mobile-photo-page")&&(r="Couldn't load mobile photo page"),n.message&&(r+=": "+n.message);if(n.code===1)return e.fletrics.increment("route.photo.route.404"),i.displayRouteErrors(t,new e.RouteError(404,r));if(n.code===2){if(!i.appContext.getViewer().signedIn)return e.Promise.resolve({redirect:"/signin/?redir="+t.url})}else if(!t.UA.isMobileBrowser)return{view:"empty-photo-page-view",params:{},title:i.intlMessage({intlName:"common.OOPS"}),layout:"scrolling",darkLoader:!0};if(n.fatal)throw e.fletrics.increment("route.photo.route.500"),n;return e.fletrics.increment("route.photo.route.404"),i.displayRouteErrors(t,new e.RouteError(404,r))})},verifyPhotoIsViewable:function(t){var r=t.getValue("id");return n.photoId(r)?r:new e.RouteError(404,this.intlMessage({intlName:"photo-page-scrappy.NO_PHOTO_WITH_THAT_ID",photoId:r}))},verifyPhotoIsOwnedByPerson:function(t,r){var i=t.getValue("id"),s=n.nsid(r);return r===t.getValue("owner").getValue(s?"id":"pathAlias")?t.getValue("owner").getValue("id"):new e.RouteError(404,"Photo "+i+" is not owned by "+r)},parseContext:function(t,n,r){return t=t||"photostream",e.URLHelper.parseContextURL(t,n,this.appContext)},detectBackToDestination:function(t,n){var r,i,s,o,u;if(e.config.flickr.homerun&&(e.config.flickr.ycParam||t.query&&t.query.yc)){u=e.config.flickr.ycParam?e.config.flickr.ycParam:t.query.yc;if(e.config.flickr.homerun.yc.indexOf(u.replace(/https?:\/\//,""))!==-1)return this.setBackToData({name:"Yahoo"},u.match(/https?:/)?u:"https://"+u,n)}if(YUI.Env.isServer){r=t.headers.referrer||t.headers.referer;if(/^https?:\/\/[^\/]*(?:flickr\.com|flic\.kr)(?:$|\/)/.test(r)){if(n.context)return i=e.URLHelper.getContextEntity(n.context,n.person),this.setBackToData(e.URLHelper.getSiteSectionByName(i.type),i.url,n);r="/"+r.split("/").slice(3).join("/"),o=e.URLHelper.getSiteSectionByURL(r);if(o)return this.setBackToData(o,o.match,n)}else if(n.context)return i=e.URLHelper.getContextEntity(n.context,n.person),this.setBackToData(e.URLHelper.getSiteSectionByName(i.type),i.url,n)}else{r=this.appContext.getPreviousURL(),s=this.appContext.flapp.get("activeView");if(["photo-page-scrappy-view","photo-page-lightbox-scrappy-view","photo-page-ad-scrappy-view"].indexOf(s.name)>-1){if(s.backToURL){o=e.URLHelper.getSiteSectionByURL(s.backToURL);if(o)return this.setBackToData(o,s.backToURL,n)}}else if(r!==e.config.win.location
.pathname){o=e.URLHelper.getSiteSectionByURL(r);if(o)return this.setBackToData(o,o.match,n)}}return this.setBackToData(null,null,n)},setBackToData:function(t,n,r){var o=YUI.Env.isServer?this:s,u,a,f;u=t?i[t.name]:null,u||(t=e.URLHelper.getSiteSectionByName("photostream"),n="/photos/"+r.person,u=i.photostream),a=e.merge(u,t),f=a.withParamName||"with",n=this.stripPathSuffixes(n),a.usesWith&&(n=n.replace(/([^\/])$/,"$1/"),n+=f+"/"+r.photoId),n[n.length-1]!=="/"&&n.indexOf("?")===-1&&(n+="/"),o._entryType=a.name,o._entryPath=n,o._backToIntlKey=a.backToIntlKey},getBackToData:function(){var e=YUI.Env.isServer?this:s;return{type:e._entryType,path:e._entryPath,backToIntlKey:e._backToIntlKey}},stripPathSuffixes:function(e){return e=e.replace(/\/+/g,"/"),e=e.replace(/\/with\/\d+\/?$/,"/"),e=e.replace(/\/in\/[^\/]+\/?$/,"/"),e=this.filterURL(e,function(e){var t;if(e.length>=3)for(t=2;t<e.length;t++)e[t].match(/page\d+/)&&(e.splice(t,1),t--);return e}),e=this.filterURL(e,function(e){var t;if(e[0]==="groups"&&e.length>=3)for(t=2;t<e.length;t++)e[t]==="pool"&&(e.splice(t,1),t--);return e}),e},filterURL:function(e,t){var n,r;return r=e.split("/").filter(function(e){return!!e}),n="/"+t(r).join("/"),n[n.length-1]!=="/"&&e.indexOf("?")===-1&&(n+="/"),n}}),e.mix(s.prototype,e.Localizable),e.mix(s.prototype,e.Seo)},"@VERSION@",{requires:["flickr-route","url-helper","fletrics","localizable","seo"],optional:["photo-models","photostream-models","photo-page-scrappy-view","empty-photo-page-view","photo-page-lightbox-scrappy-view"],langBundles:["photo-page-scrappy","common","attribution"]});
YUI.add("photo-well-view",function(e,t){var n=require("lib/flog")(t),r=1,i=5;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.isAd=!!t.ad,this.firstLoad=!!t.firstLoad,this.publisherUrl=t.publisherUrl,t.isFluid=!0,t.isOnDark=!0,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},subviewConfig:{"photo-well-media-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-sidebar-toggle-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,disabled:function(){return this.appContext.flipper.isFlipped("enable-similarity-search-from-photo-page")}},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen","photo-attribution"]},"photo-sidebar-actions-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen"],disabled:function(){return this.appContext.experiments.fullscreen.disableRealFullscreenButtons()}},"people-notes-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:!0}},buildContainer:function(){var e=this,t="",n,r=0,i,s,o=".navigate-prev",u=".navigate-next",a,f,l,c,h;return this.firstLoad||(this.subviews["photo-sidebar-actions-view"]&&this.subviews["photo-sidebar-actions-view"].get("container").addClass("is-hidden"),this.subviews["photo-sidebar-toggle-view"]&&this.subviews["photo-sidebar-toggle-view"].get("container").addClass("is-hidden")),this.appContext.experiments.fullscreen.getMode()?this.subviews["attribution-view"]&&(YUI.Env.isServer||this.subviews["attribution-view"].get("container").removeClass("is-always-hidden"),!this.firstLoad&&this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&this.subviews["attribution-view"].get("container").addClass("is-hidden"),t=this.subviews["attribution-view"].get("container")):this.subviews["attribution-view"]&&(this.subviews["attribution-view"].get("container").addClass("is-always-hidden"),t=this.subviews["attribution-view"].get("container")),this.get("contextModel")&&(n=this.get("contextModel").getValue("photoContextList").getList(),n.length>2&&n.some(function(t){return r++,t.getValue("id")===e.photoId})&&(i=n.slice(r-2,r-1),s=n.slice(r,r+1),i&&i.length>0&&(a=e.setupNavLink(i[0],o,"previous"),l=e.setupNavTitle(i[0])),s&&s.length>0&&(f=e.setupNavLink(s[0],u,"next"),c=e.setupNavTitle(s[0])))),this.appContext.flipper.isFlipped("enable-similarity-search-from-photo-page")&&(h=this.get("photo").getValue("similaritySearchURL")),this.setContainerWithTemplate("photo-well",{"is-video":this.get("photo").getValue("isVideo"),"is-hidden":(YUI.Env.isServer||!this.firstLoad)&&!a&&!f,"prev-is-not-clickable":!a,"next-is-not-clickable":!f,"prev-url":a,"next-url":f,"prev-title":l,"next-title":c,"is-ad":this.isAd,"opt-out-enabled":this.appContext.experiments.optOut.enabled(),"attribution-view":t,enableZoom:!0,similaritySearchURL:h}),YUI.Env.isServer&&(this.serverWidth=this.subviews["photo-well-media-view"].serverWidth,this.serverHeight=this.subviews["photo-well-media-view"].serverHeight),this},loadState:function(){var t=this,n=[];return n.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){if(!e)throw new Error("[photo-well-view] Invalid photoModel returned from getModel");t.set("photo",e)})),this.contextData&&this.contextData.modelName&&this.contextData.params&&n.push(this.appContext.getModelRegistry(this.contextData.modelName).then(function(e){var n;if(e){n=e.attributeSearch(t.contextData.params);if(n&&n.length&&e.exists(n[0]))return t.appContext.getModel(t.contextData.modelName,n[0]).then(function(e){e&&t.set("contextModel",e)})}}).then(null,function(){return"whatever"})),e.Promise.all(n)},setLinkAsAdFriendly:function(e){var t=e.currentTarget;t.hasClass("navigate-next")?this.appContext.adManager.setAdCouldBeShown(!0,"next",t.getAttribute("href")):this.appContext.adManager.setAdCouldBeShown(!0,"previous",t.getAttribute("href"))},animateNavigation:function(){var t=e.all(".navigate-target"),n=this.get("container"),r=n.one(".photo-sidebar-toggle-view"),i=n.one(".attribution-view"),s=n.one(".similarity-search-link"),o=1500,u=250,a=!1,f=!1,l,c=!0,h=this;o=(o-500)/2,a=!0,f=this.appContext.experiments.fullscreen.getMode(),this.registerEventHandler(n.on("mousemove",e.betterThrottle(function(e){l=n.one(".photo-sidebar-actions-view"),t&&c&&t.removeClass("is-hidden"),a&&c&&(l&&l.removeClass("is-hidden"),r&&r.removeClass("is-hidden"),i&&i.removeClass("is-hidden"),s&&s.removeClass("is-hidden")),clearTimeout(h.movingTimeout),clearTimeout(h.initialTimeout),c=!0,h.followViewOpen||(h.movingTimeout=setTimeout(h.hideUI.bind(h),o*2))},u))),!this.firstLoad&&this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&(c=!1),h.initialTimeout=setTimeout(function(){c=!0,l=n.one(".photo-sidebar-actions-view"),t&&h.firstLoad&&t.addClass("is-hidden"),a&&c&&(l&&l.addClass("is-hidden"),r&&r.addClass("is-hidden"),i&&i.addClass("is-hidden"),s&&s.addClass("is-hidden"))},o*2)},hideUI:function(){var e=this.get("container"),t=e.one(".photo-sidebar-actions-view"),n=e.one(".photo-sidebar-toggle-view"),r=e.one(".attribution-view"),i=e.one(".similarity-search-link");t&&t.addClass("is-hidden"),n&&n.addClass("is-hidden"),r&&r.addClass("is-hidden"),i&&i.addClass("is-hidden")},onSubviewEvent:function(e,t){var n=1500;n=(n-500)/2,e==="attribution-view"&&t[0]==="isOpen"?(this.followViewOpen=!0,clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout)):e==="attribution-view"&&t[0]==="isClosed"&&(this.followViewOpen=!1,this.movingTimeout=setTimeout(this.hideUI.bind(this),n*2))},activate:function(){var t=this,s=this.contextData,o=0,u,a,f,l,c=".navigate-prev",h=".navigate-next";return YUI.Env.isServer||(a=e.getLocation(),f=a.protocol,l=a.hostname,t.appContext.getModel(s.modelName,s.params).then(function(e){t.set("contextModel"
,e)},function(n){if(!n.getModelFailure&&n.code!==1||s.modelName==="photostream-models")throw e.all(c).hide(),e.all(h).hide(),n;return t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.appContext.getModel("photostream-models",t.contextData.params).then(function(e){t.set("contextModel",e)})}).then(function(){var n=t.get("contextModel").getValue("photoContextList"),r=n.getList(),i,u,a,p,d;return r.length>2&&r.some(function(e){return o++,e.getValue("id")===t.photoId})&&(u=r.slice(o-2,o-1),a=r.slice(o,o+1),u&&u.length>0&&(p=t.setupNavLink(u[0],c,"previous"),p&&(t.updateNavLinks(c,f,l,p),t.get("container").all(c).removeClass("no-click"))),a&&a.length>0&&(d=t.setupNavLink(a[0],h,"next"),d&&(t.updateNavLinks(h,f,l,d),t.get("container").all(h).removeClass("no-click")))),i=e.merge(s.params,{photoId:t.photoId,numNext:10,numPrev:10}),n.getContext(i)}).then(function(n){function s(s,o){var u=t.get("container").all(s),a,c,h,p,d,v,m=n&&n[o]&&n[o].length;if(!u.size())return;if(!m){u.remove();return}u.removeClass("no-click"),a=t.setupNavLink(n[o][0],s,o);if(t.isAd)h=t.appContext.adManager.origin,o===h.arrow?(u.setAttribute("href",h.url),u.removeClass("is-hidden")):(u.setAttribute("href",a),u.removeClass("is-hidden"));else{t.updateNavLinks(s,f,l,a),c=t.subviews["photo-well-media-view"].getCanvasSize();for(v=0;v<i;v++){if(!n[o][v])break;p=n[o][v].getSizeToFit(c,{includeSizes:["sq","q","t","s","n"]}),p&&p.url&&(d=new Image,d.src=p.url)}for(v=0;v<r;v++){if(!n[o][v])break;p=n[o][v].getSizeToFit(c),p&&p.url&&(d=new Image,e.LH.mark("mark_time_to_load_photo_only_start"),d.onload=function(){e.LH.mark("mark_time_to_load_photo_only");var t=e.LH.measure("time_to_load_photo_only",{startMark:"mark_time_to_load_photo_only_start",endMark:"mark_time_to_load_photo_only"});!YUI.Env.isServer&&e.config.win.beaconPerformance&&window.beaconPerformance("time_to_load_photo_only",window.location.href,{duration:t.duration})},d.src=p.url)}}}t.appContext.adManager.updateContext({prev:n.previous[0],current:t.get("photo"),next:n.next[0],type:t.contextData.modelName}),s(h,"next"),s(c,"previous"),t.animateNavigation(),t.isAd&&t.appContext.adManager.markAdAsSeen()},function(e){if(e.notInContext||e.code===99)return t.get("contextModel").setValue("photoContextList",[]),t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.activate();throw e}).then(null,function(e){n.warn("There was a problem initializing the next/previous controls.",{err:e})}),this.attachKeyEvent("down:37,75,39,74",t.handlePrevNextKeys.bind(t)),this.get("photo").getValue("isOwner")||this.appContext.getViewCounter().queue(this.get("photo").getValue("id"),this.publisherUrl||this.appContext.getReferrer())),u={":ad":t.setLinkAsAdFriendly},t.attachEvents(u),this},setupNavLink:function(t,r,i){var s=this.get("container").all(r),o,u;if(!t&&s.size()){s.remove();return}o=t,u=e.URLHelper.getPhotoPage({photoId:o.getValue("id"),pathAlias:o.getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextModel").getValue("urlSuffix"),lightbox:this.appContext.experiments.fullscreen.getMode()});if(!u||u==="#"){n.warn("Invalid next/prev URL",{url:u}),s.remove();return}return u},setupNavTitle:function(e){var t;return e.getValue("owner")&&(e.getValue("title").trim()===""?t=this.intlMessage({intlName:"common.UNTITLED"}):t=e.getValue("title"),t+=" | "+this.intlMessage({intlName:"common.BY_USER",user:e.getValue("owner").getValue("username")})),t},updateNavLinks:function(e,t,n,r){var i=this.get("container").all(e);i.setAttribute("href",t+"//"+n+r),this.firstLoad&&i.removeClass("is-hidden")},destructor:function(){clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout),this.movingTimeout=null,this.initialTimeout=null},handleFeedbackClick:function(t){if(t.target.ancestor(".ui-dialog",!0))return;t.halt(),this.feedbackDialog.toggle(),e.rapidTracker.beacon(this.name,"helpFeedbackMenuClick")},handlePrevNextKeys:function(t){var r=this,i,s,o,u=50;if(t.button===37||t.button===75)s=".navigate-prev",o="previous",e.rapidTracker.beacon(this.name,"prevPhotoKeyPress");else if(t.button===39||t.button===74)s=".navigate-next",o="next",e.rapidTracker.beacon(this.name,"nextPhotoKeyPress");s&&r.get("container").one(s)&&(t.preventDefault(),i=r.get("container").one(s).getAttribute("href"),i&&i!=="#"&&(r.keyboardNavigation&&r.keyboardNavigation.url&&i===r.keyboardNavigation.url&&(new Date).getTime()-r.keyboardNavigation.time<u?n.log("Ignoring duplicate keyboard navigation",{url:i}):(r.keyboardNavigation={url:i,time:(new Date).getTime()},this.appContext.adManager.setAdCouldBeShown(!0,o,i),r.appContext.flapp.navigate(i))))},handleContextMenu:function(e){e.preventDefault(),this.fire("subviewViewEvent","rightClickPhoto")}})},"@VERSION@",{requires:["yui-throttle","flickr-view","hermes-template-photo-well","url-helper","better-throttle","hermes-template-reboot-welcome-dialog-content","hermes-template-photo-opt-out"],optional:["photo-well-media-view","photo-models","photo-route"],langBundles:["common"]});
YUI.add("photo-privacy-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r;return r={photo_id:t,is_public:this.getValue(t,"isPublic"),is_friend:this.getValue(t,"isVisibleByFriends"),is_family:this.getValue(t,"isVisibleByFamily"),perm_addmeta:this.getValue(t,"permAddMeta"),perm_comment:this.getValue(t,"permComment")},e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)},batchUpdate:function(t,n){var r;switch(!0){case"privacy"in n&&"commenting"in n&&"addMeta"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_addmeta:n.addMeta,perm_comment:n.commenting};break;case"privacy"in n&&"commenting"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_comment:n.commenting};break;case"privacy"in n&&"addMeta"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily,perm_addmeta:n.addMeta};break;case"commenting"in n&&"addMeta"in n:r={photo_ids:t,perm_addmeta:n.addMeta,perm_comment:n.commenting};break;case"privacy"in n:r={photo_ids:t,is_public:n.privacy.isPublic,is_friend:n.privacy.isVisibleByFriends,is_family:n.privacy.isVisibleByFamily};break;case"commenting"in n:r={photo_ids:t,perm_comment:n.commenting};break;case"addMeta"in n:r={photo_ids:t,perm_addmeta:n.addMeta}}return r.full_response=1,e.ModelUpdaters["flickr-photos-setPerms"].run(r,this.appContext)}},attributes:{isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},permAddMeta:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},permComment:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getPerms-fetcher","flickr-photos-setPerms-updater","attribute-helpers"]});
YUI.add("flickr-photos-getPerms-fetcher",function(e,t){"use strict";function n(e,t){var n=e[0],r=e[1],i;i={id:t.id,isPublic:n.perms.ispublic,isVisibleByFriends:n.perms.isfriend,isVisibleByFamily:n.perms.isfamily,permAddMeta:n.perms.permaddmeta,permComment:n.perms.permcomment},r.addOrUpdate(i)}function r(n,r){var i=n.id,s={photo_id:i},o=this;return e.Promise.all([r.callAPI("flickr.photos.getPerms",s),r.getModelRegistry("photo-privacy-models")]).then(function(e){return o._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]});
